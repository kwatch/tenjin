<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html">
  <title>phpTenjin User's Guide</title>
  <meta name="generator" content="kwaser">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <link rel="stylesheet" href="docstyle.css" type="text/css">
 </head>
 <body>

  <blockquote>
   <div class="mainbody">

    <div align="left"><h1>phpTenjin User's Guide</h1></div>
    <div align="left">
      last update: $Date$<br>
    </div>

<p>Release: $Release$
</p>
<p>Table of Contents:
<ul>
  <li><a href="#intro">Introduction</a>
  <ul>
    <li><a href="#overview">Overview</a>
    </li>
    <li><a href="#features">Features</a>
    </li>
    <li><a href="#comparison">Comparison with other solutions</a>
    </li>
    <li><a href="#benchmark">Benchmark</a>
    </li>
  </ul>
  </li>
  <li><a href="#installation">Installation</a>
  </li>
  <li><a href="#desguide">Designer's Guide</a>
  <ul>
    <li><a href="#des-notation">Notation</a>
    </li>
    <li><a href="#des-convert">Convert into PHP Code</a>
    </li>
    <li><a href="#des-syntaxchk">Syntax Checking</a>
    </li>
    <li><a href="#des-contextdata">Context Data File</a>
    </li>
    <li><a href="#des-cmlinecontext">Command-line Context Data</a>
    </li>
    <li><a href="#des-nested-template">Nested Template</a>
    </li>
    <li><a href="#des-layout">Layout Template</a>
    </li>
    <li><a href="#des-capturing">Capturing</a>
    </li>
    <li><a href="#des-args">Template Arguments</a>
    </li>
    <li><a href="#des-preprocess">Preprocessing</a>
    </li>
    <li><a href="#des-otheropts">Other Options</a>
    </li>
  </ul>
  </li>
  <li><a href="#devguide">Developer's Guide</a>
  <ul>
    <li><a href="#dev-example">An Example</a>
    </li>
    <li><a href="#dev-classes">Classes and Functions in phpTenjin</a>
    </li>
    <li><a href="#dev-templateclass">Class Tenjin_Template</a>
    </li>
    <li><a href="#dev-engineclass">Class Tenjin_Engine</a>
    </li>
    <li><a href="#dev-initopts">Template Initialize Options</a>
    </li>
    <li><a href="#dev-othertopics">Other Topics</a>
    </li>
  </ul>
  </li>
</ul>
</p>
<a name="intro"></a>
<h2 class="section1">Introduction</h2>
<a name="overview"></a>
<h3 class="section2">Overview</h3>
<p>phpTenjin is a very fast and lightweight template engine based on embedded PHP.
You can embed PHP statements and expressions into your text file.
phpTenjin converts it into PHP script and evaluate it.
</p>
<p>The following is an example of phpTenjin.
</p>
<a name="ex.phtml"></a>
<div class="program_caption">
File 'ex.phtml':</div>
<pre class="program">Hello <strong>{==$name=}</strong>!
&lt;ul&gt;
<strong>&lt;?php foreach ($items as $item) { ?&gt;</strong>
 &lt;li&gt;<strong>{=$item=}</strong>&lt;/li&gt;
<strong>&lt;?php } ?&gt;</strong>
&lt;/ul&gt;
</pre>
<p>Here is the notation:
</p>
<ul type="disc">
<li><code>&lt;?php ... ?&gt;</code> represents embedded PHP statements.
</li>
<li><code>{== ... =}</code> represents embedded PHP expression.
</li>
<li><code>{= ... =}</code> represents embedded escaped (sanitized) PHP expression.
</li>
</ul>
<a name="ex_source.result"></a>
<div class="terminal_caption">
Result of covertion into PHP script:</div>
<pre class="terminal">$ phptenjin -s ex.phtml
&lt;?php echo 'Hello ', $name, '!
&lt;ul&gt;
'; foreach ($items as $item) { 
echo ' &lt;li&gt;', htmlspecialchars($item), '&lt;/li&gt;
'; } 
echo '&lt;/ul&gt;
';
?&gt;
</pre>
<a name="ex.result"></a>
<div class="terminal_caption">
Output of execution with context data:</div>
<pre class="terminal">$ phptenjin -c '$name="World"; $items=array("&lt;AAA&gt;","B&amp;B","\"CCC\"");' ex.phtml
Hello World!
&lt;ul&gt;
 &lt;li&gt;&amp;lt;AAA&amp;gt;&lt;/li&gt;
 &lt;li&gt;B&amp;amp;B&lt;/li&gt;
 &lt;li&gt;&amp;quot;CCC&amp;quot;&lt;/li&gt;
&lt;/ul&gt;
</pre>
<a name="ex.script"></a>
<div class="program_caption">
Example of PHP script</div>
<pre class="program">&lt;?php
require_once 'Tenjin.php';
$engine = new Tenjin_Engine();
$context = array('name'=&gt;'World', 'items'=&gt;array('&lt;AAA&gt;', 'B&amp;B', '"CCC"'));
$output = $engine-&gt;render('ex.phtml', $context);
echo($output);
?&gt;
</pre>
<br>


<a name="features"></a>
<h3 class="section2">Features</h3>
<p>phpTenjin has the following features:
</p>
<ul type="disc">
<li>phpTenjin runs very fast. It works about twice as fast as Smarty.
</li>
<li>phpTenjin doesn't break HTML design because it uses XML Processing
  Instructions (PI) as embedded notation for PHP statements.
</li>
<li>phpTenjin is secure because it supports escaping expression value by default.
</li>
<li>phpTenjin is small and lightweight. It is very easy to include phpTenjin
  into your application.
</li>
<li>phpTenjin supports auto caching of converted PHP code.
</li>
<li>phpTenjin supports partial template and layout template.
  These are very useful especially for web application.
</li>
<li>phpTenjin supports partial capturing of template.
</li>
<li>phpTenjin can load YAML file as context data. Using phpTenjin, it is able to
  separate template file and data file.
</li>
</ul>
<br>


<a name="comparison"></a>
<h3 class="section2">Comparison with other solutions</h3>
<p>phpTenjin has advantages compared with other solutions (including other language solutions):
</p>
<ul type="disc">
<li><strong>Easy to design</strong> --
  JSP, ePerl, or eRuby breaks HTML design because they use
  '<code>&lt;% ... %&gt;</code>' as embedded notation which is not valid in HTML.
  phpTenjin doesn't break HTML desgin because it uses Processing
  Instructions (PI) as embedded notation which is valid in HTML.
</li>
<li><strong>Easy to write</strong> --
  In PHP, it is a little bother to write embedded expression
  because the notation '<code>&lt;?php echo $value; ?&gt;</code>' is a little long,
  and very bother to embed escaped expression because
  '<code>&lt;?php echo htmlspecialchars($value); ?&gt;</code>' is very long.
  In phpTenjin, these are very easy to write because embedded expression
  notations ('<code>#{value}</code>' and '<code>${value}</code>') are very short.
</li>
<li><strong>Easy to learn</strong> --
  Some template systems
  are hard to learn because they are large, highly functinal, and
  based on non-PHP syntax.
  phpTenjin is very easy to learn if you already know PHP language because
  it is very small and  you can embed any PHP code into HTML template.
</li>
</ul>
<br>


<a name="benchmark"></a>
<h3 class="section2">Benchmark</h3>
<p>Benchmark script is contained in phpTenjin archive.
The following is an example of benchmark.
</p>
<pre class="terminal">$ cd pltenjin-X.X.X/benchmark
$ php -v
PHP 5.2.0 (cli) (built: Jan 29 2007 18:35:33) 
Copyright (c) 1997-2006 The PHP Group
Zend Engine v2.2.0, Copyright (c) 1998-2006 Zend Technologies
$ php bench.php -n 10000
*** ntimes=10000
                          user        sys      total       real
tenjin                  4.2300     1.1600     5.3900     5.4362
tenjin_reuse            3.1600     0.4800     3.6400     3.6688
smarty                 10.1100     0.7300    10.8400    10.9260
smarty_reuse            9.5100     0.6900    10.2100    10.2996
php                     3.0300     0.4900     3.5200     3.5620
</pre>
<br>


<br>


<a name="installation"></a>
<h2 class="section1">Installation</h2>
<ol type="1">
<li>Just copy 'lib/Tenjin.php' and 'bin/pltenjin' into your proper directory.
<pre class="terminal">$ sudo cp lib/Tenjin.php /usr/local/lib/php
$ sudo cp bin/pltenjin /usr/local/bin
</pre>
</li>
<li>(Optional) Install Syck library for YAML parsing.
</li>
</ol>
<br>


<a name="desguide"></a>
<h2 class="section1">Designer's Guide</h2>
<p>This section shows how to use phpTenjin for designer.
</p>
<p>If you want to know how to use phpTenjin in your program, see <a href="#devguide">Developer's Guide</a> section.
</p>
<a name="des-notation"></a>
<h3 class="section2">Notation</h3>
<p>The following is the notation of phpTenjin.
</p>
<ul type="disc">
<li>'<code>&lt;?php ... ?&gt;</code>' represents embedded PHP statement.
</li>
<li>'<code>{== ... =}</code>' represents embedded PHP expression.
</li>
<li>'<code>{= ... =}</code>' represents embedded PHP expression which is to be escaped (for example, '<code>&amp; &lt; &gt; "</code>' is escaped to '<code>&amp;amp; &amp;lt; &amp;gt; &amp;quot;</code>').
</li>
</ul>
<a name="example1.phtml"></a>
<div class="program_caption">
File 'example1.phtml':</div>
<pre class="program">&lt;table&gt;
  &lt;tbody&gt;
<strong>&lt;?php $items = array('&lt;foo&gt;', 'bar&amp;bar', '"baz"'); ?&gt;</strong>
<strong>&lt;?php foreach ($items as $item) { ?&gt;</strong>
    &lt;tr&gt;
      &lt;td&gt;<strong>{==$item=}</strong>&lt;/td&gt;
      &lt;td&gt;<strong>{=$item=}</strong>&lt;/td&gt;
    &lt;/tr&gt;
<strong>&lt;?php } ?&gt;</strong>
  &lt;tbody&gt;
&lt;/table&gt;
</pre>
<p>The following is the result of executing 'example1.phtml'.
</p>
<a name="example1.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin example1.phtml
&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;<strong>&lt;foo&gt;</strong>&lt;/td&gt;
      &lt;td&gt;<strong>&amp;lt;foo&amp;gt;</strong>&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;<strong>bar&amp;bar</strong>&lt;/td&gt;
      &lt;td&gt;<strong>bar&amp;amp;bar</strong>&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;<strong>"baz"</strong>&lt;/td&gt;
      &lt;td&gt;<strong>&amp;quot;baz&amp;quot;</strong>&lt;/td&gt;
    &lt;/tr&gt;
  &lt;tbody&gt;
&lt;/table&gt;
</pre>
<p>phpTenjin's error reporting may be not useful because it doesn't report filename on which error happended in default<sup>(<a href="#fnref:1" name="fnlink:1">*1</a>)</sup>.
The following is an error example and it shows that errored filename is not reported.
</p>
<a name="ex2_error.result"></a>
<pre class="terminal">$ phptenjin ex2.phtml

Parse error: syntax error, unexpected T_ECHO in <strong>/usr/local/lib/php/Tenjin.php(497) : eval()'d code</strong> on line 2
</pre>
<p>If you specify <code>--cache</code> option, <code>phptenjin</code> will report errored filename (and also temporary cache file will be created)<sup>(<a href="#fnref:2" name="fnlink:2">*2</a>)</sup>.
</p>
<a name="ex2_error_with_filename.result"></a>
<pre class="terminal">$ phptenjin <strong>--cache</strong> ex2.phtml

Parse error: syntax error, unexpected T_ECHO in <strong>/home/tmp/ex2.phtml.cache</strong> on line 2
</pre>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:1" href="#fnlink:1">*1</a>)</dt>
  <dd>This is a restriction of phpTenjin because <code>eval()</code> of PHP can't take filename as argument.</dd>
  <dt>(<a name="fnref:2" href="#fnlink:2">*2</a>)</dt>
  <dd>If <code>--cache</code> is specified, PHP's function <code>include()</code> is called instead of <code>eval()</code>.</dd>
 </dl>
</div>
<br>


<a name="des-convert"></a>
<h3 class="section2">Convert into PHP Code</h3>
<p>Command-line option '-s' converts embedded files into PHP code.
</p>
<a name="example1_source.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin <strong>-s</strong> example1.phtml
&lt;?php echo '&lt;table&gt;
  &lt;tbody&gt;
'; <strong>$items = array('&lt;foo&gt;', 'bar&amp;bar', '"baz"');</strong> 
 <strong>foreach ($items as $item) {</strong> 
echo '    &lt;tr&gt;
      &lt;td&gt;', <strong>$item</strong>, '&lt;/td&gt;
      &lt;td&gt;', <strong>htmlspecialchars($item)</strong>, '&lt;/td&gt;
    &lt;/tr&gt;
'; <strong>}</strong> 
echo '  &lt;tbody&gt;
&lt;/table&gt;
';
?&gt;
</pre>
<ul type="disc">
<li>Variable <code></code> is a array.
  Command-line option <code>--escapefunc=func</code> makes phptenjin to use <code>func()</code> instead of <code>escape()</code>.
</li>
<li>Newline character ("\n" or "\r\n") is automatically detected by phpTenjin.
</li>
</ul>
<p>'<code>&lt;?php</code>' is called as preamble and '<code>?&gt;</code>' is called as postamble.
Command-line option '<code>-b</code>' removes preamble and postamble.
</p>
<a name="example2.phtml"></a>
<div class="program_caption">
File 'example2.phtml'</div>
<pre class="program">&lt;?php $list = array(1, 2, 3); ?&gt;
&lt;?php for ($list as $item) { ?&gt;
&lt;p&gt;{==$item=}&lt;/p&gt;
&lt;?php } ?&gt;
</pre>
<a name="example2_sb.result2"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin -s example2.phtml
<strong>&lt;?php</strong>  $list = array(1, 2, 3); 
 for ($list as $item) { 
echo '&lt;p&gt;', $item, '&lt;/p&gt;
'; } 
<strong>?&gt;</strong>
$ phptenjin -s<strong>b</strong> example2.phtml
 $list = array(1, 2, 3); 
 for ($list as $item) { 
echo '&lt;p&gt;', $item, '&lt;/p&gt;
'; } 
</pre>
<p>Command-line option '-S' also show converted PHP code but it doesn't print text part.
This is useful to check PHP code for debugging.
</p>
<a name="example1_S.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin <strong>-S</strong> example1.phtml
&lt;?php 

 $items = array('&lt;foo&gt;', 'bar&amp;bar', '"baz"'); 
 foreach ($items as $item) { 

          $item; 
          htmlspecialchars($item); 

 } 


?&gt;
</pre>
<p>In addition, the following command-line options are available.
</p>
<dl class="dl3" compact>
<dt class="dt3"><b>
-N </b></dt>
<dd class="dd3">
	     Add line number.
</dd>
<dt class="dt3"><b>
-X </b></dt>
<dd class="dd3">
	     Delete expressions.
</dd>
<dt class="dt3"><b>
-C </b></dt>
<dd class="dd3">
	     Remove empty lines (compact-mode).
</dd>
<dt class="dt3"><b>
-U </b></dt>
<dd class="dd3">
	     Compress empty lines to a line (uniq-mode).
</dd>
</dl>
<a name="example1_SXNC.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin <strong>-SUNX</strong> example1.phtml
    1:  &lt;?php 

    3:   $items = array('&lt;foo&gt;', 'bar&amp;bar', '"baz"'); 
    4:   foreach ($items as $item) { 

    6:            $item; 
    7:            htmlspecialchars($item); 

    9:   } 

   12:  ?&gt;
</pre>
<br>


<a name="des-syntaxchk"></a>
<h3 class="section2">Syntax Checking</h3>
<p>Command-line option '<code>-z</code>' checks syntax error in embedded PHP code.
</p>
<a name="example3.phtml"></a>
<div class="program_caption">
File example3.phtml:</div>
<pre class="program">&lt;ul&gt;
&lt;?php <strong>for</strong> ($items <strong>as</strong> $item) { ?&gt;
  &lt;li&gt;{=$item=}&lt;/li&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;
</pre>
<a name="example3_syntaxcheck.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin <strong>-z</strong> example3.phtml
[NG] example3.phtml
Parse error: syntax error, unexpected T_AS, expecting ';' in example3.phtml on line 2
Errors parsing example3.phtml
</pre>
<p>Command-line option '-z' is more convenient than '<code>phptenjin -s file | php -l</code>'
because the former can take several filenames.
</p>
<p>Command-line option '-q' (quiet-mode) prints nothing if it has no errors.
</p>
<br>


<a name="des-contextdata"></a>
<h3 class="section2">Context Data File</h3>
<p>phpTenjin allows you to specify context data by YAML file or PHP script.
</p>
<a name="example4.phtml"></a>
<div class="program_caption">
File 'example4.phtml':</div>
<pre class="program">&lt;p&gt;
  {=$text=}
  {==$num=}
  {==$flag=}
&lt;/p&gt;

&lt;?php foreach ($items as $item) { ?&gt;
&lt;p&gt;{=$item=}&lt;/p&gt;
&lt;?php } ?&gt;

&lt;?php foreach ($hash as $key=&gt;$val) { ?&gt;
&lt;p&gt;{=$key=} = {=$val=}&lt;/p&gt;
&lt;?php } ?&gt;
</pre>
<a name="datafile.yaml"></a>
<div class="program_caption">
File 'datafile.yaml':</div>
<pre class="program">text:   foo
num:    3.14
flag:   yes
items:
  - foo
  - bar
  - baz
hash:
  x: 1
  y: 2
</pre>
<a name="example4_yaml.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin <strong>-f datafile.yaml</strong> example4.phtml
&lt;p&gt;
  foo
  3.14
  1
&lt;/p&gt;

&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;p&gt;baz&lt;/p&gt;

&lt;p&gt;x = 1&lt;/p&gt;
&lt;p&gt;y = 2&lt;/p&gt;
</pre>
<a name="datafile.php"></a>
<div class="program_caption">
File 'datafile.php':</div>
<pre class="program">$text  =  "foo";
$num   =  3.14;
$flag  =  true;
$items =  array("foo", "bar", "baz");
$hash  =  array('x'=&gt;1, 'y'=&gt;2);
</pre>
<a name="example4_datafile_php.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin <strong>-f datafile.php</strong> example4.phtml
&lt;p&gt;
  foo
  3.14
  1
&lt;/p&gt;

&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;p&gt;baz&lt;/p&gt;

&lt;p&gt;x = 1&lt;/p&gt;
&lt;p&gt;y = 2&lt;/p&gt;
</pre>
<p>You must install Syck library if you want to use YAML-format context data file.
</p>
<br>


<a name="des-cmlinecontext"></a>
<h3 class="section2">Command-line Context Data</h3>
<p>Command-line option '<code>-c</code>' specifies context data in YAML format or PHP code.
</p>
<a name="example5.phtml"></a>
<div class="program_caption">
File 'example5.phtml':</div>
<pre class="program">text:  {==$text=}
items:
&lt;?php foreach ($items as $item) { ?&gt;
  - {==$item=}
&lt;?php } ?&gt;
hash:
&lt;?php foreach ($hash as $key=&gt;$val) { ?&gt;
  {==$key=}: {==$val=}
&lt;?php } ?&gt;
</pre>
<a name="example5_datastr_php.result"></a>
<div class="terminal_caption">
Result of context data in php code:</div>
<pre class="terminal">$ phptenjin <strong>-c '$text="foo"; $items=array("a","b","c"); $hash=array("x"=&gt;1,"y"=&gt;2);'</strong> example5.phtml
text:  foo
items:
  - a
  - b
  - c
hash:
  x: 1
  y: 2
</pre>
<a name="example5_datastr_yaml.result"></a>
<div class="terminal_caption">
Result of context data in yaml format:</div>
<pre class="terminal">$ phptenjin <strong>-c '{text: foo, items: [a, b, c], hash: {x: 1, y: 2} }'</strong> example5.phtml
text:  foo
items:
  - a
  - b
  - c
hash:
  x: 1
  y: 2
</pre>
<p>You must install Syck library at first if you want to specify context data in YAML format.
</p>
<br>


<a name="des-nested-template"></a>
<h3 class="section2">Nested Template</h3>
<p>Template can include other templates.
Included templates can also include other templates.
</p>
<p>The following function is available to include other templates.
</p>
<dl class="dl3">
<dt class="dt3"><b>
import(template_name) </b></dt>
<dd class="dd3">
    Include other template.
</dd>
</dl>
<a name="example6.phtml"></a>
<div class="program_caption">
File 'example6.phtml':</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    &lt;div id="sidemenu"&gt;
<strong>&lt;?php import('sidemenu.phtml'); ?&gt;</strong>
    &lt;/div&gt;

    &lt;div id="main-content"&gt;
&lt;?php foreach ($items as $item) { ?&gt;
      &lt;p&gt;{=$item=}&lt;/p&gt;
&lt;?php } ?&gt;
    &lt;/div&gt;

    &lt;div id="footer"&gt;
<strong>&lt;?php import('footer.phtml'); ?&gt;</strong>
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/table&gt;
</pre>
<a name="sidemenu.phtml"></a>
<div class="program_caption">
File 'sidemenu.phtml':</div>
<pre class="program">&lt;ul&gt;
&lt;?php foreach ($menu as $item) { ?&gt;
  &lt;li&gt;&lt;a href="{=$item['url']=}"&gt;{=$item['name']=}&lt;/a&gt;&lt;/li&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;
</pre>
<a name="footer.phtml"></a>
<div class="program_caption">
File 'footer.phtml':</div>
<pre class="program">&lt;hr /&gt;
&lt;address&gt;
  &lt;a href="mailto:{=$webmaster_email=}"&gt;{=$webmaster_email=}&lt;/a&gt;
&lt;/address&gt;
</pre>
<a name="contextdata.php"></a>
<div class="program_caption">
File 'contextdata.php':</div>
<pre class="program">$items = array('&lt;FOO&gt;', '&amp;BAR', '"BAZ"');
$webmaster_email = 'webmaster@example.com';
$menu = array(
          array('name'=&gt;'Top',   'url'=&gt;'/'),
          array('name'=&gt;'Products',   'url'=&gt;'/prod'),
          array('name'=&gt;'Support',   'url'=&gt;'/support'),
        );
</pre>
<a name="example6_nested.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin -f contextdata.php example6.phtml
&lt;html&gt;
  &lt;body&gt;

    &lt;div id="sidemenu"&gt;
<strong>&lt;ul&gt;</strong>
  <strong>&lt;li&gt;&lt;a href="/"&gt;Top&lt;/a&gt;&lt;/li&gt;</strong>
  <strong>&lt;li&gt;&lt;a href="/prod"&gt;Products&lt;/a&gt;&lt;/li&gt;</strong>
  <strong>&lt;li&gt;&lt;a href="/support"&gt;Support&lt;/a&gt;&lt;/li&gt;</strong>
<strong>&lt;/ul&gt;</strong>
    &lt;/div&gt;

    &lt;div id="main-content"&gt;
      &lt;p&gt;&amp;lt;FOO&amp;gt;&lt;/p&gt;
      &lt;p&gt;&amp;amp;BAR&lt;/p&gt;
      &lt;p&gt;&amp;quot;BAZ&amp;quot;&lt;/p&gt;
    &lt;/div&gt;

    &lt;div id="footer"&gt;
<strong>&lt;hr /&gt;</strong>
<strong>&lt;address&gt;</strong>
<strong>  &lt;a href="mailto:webmaster@example.com"&gt;webmaster@example.com&lt;/a&gt;</strong>
<strong>&lt;/address&gt;</strong>
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/table&gt;
</pre>
<p>'<code>import()</code>' can take template filename
(ex. 'user_main.phtml') or template short name (ex. ':main').
Template short name represents a template in short notation. It starts with colon (':').
</p>
<p>To make template short name available, command-line option '<code>--prefix</code>' and
'<code>--postfix</code>' are required.
For example, '<code>include("user_main.phtml")</code>' can be described as '<code>include(":main")</code>'
when '<code>--prefix="user_"</code>' and '<code>--postfix=".phtml"</code>' are specified in command-line.
</p>
<br>


<a name="des-layout"></a>
<h3 class="section2">Layout Template</h3>
<p>Command-line option '<code>--layout=templatename</code>' specifies layout template name.
</p>
<p>For example, 'exmample6.phtml' template in the previous section can be divided
into layout file 'layout6.phtml' and content file 'content6.phtml'.
Variable '<code>$_content</code>' in layout template represents the result of content file.
</p>
<a name="layout6.phtml"></a>
<div class="program_caption">
File 'layout6.phtml':</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    &lt;div id="sidemenu"&gt;
&lt;?php import('sidemenu.phtml'); ?&gt;
    &lt;/div&gt;

    &lt;div id="main-content"&gt;
<strong>{==$_content=}</strong>
    &lt;/div&gt;

    &lt;div id="footer"&gt;
&lt;?php import('footer.phtml'); ?&gt;
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/table&gt;
</pre>
<a name="content6.phtml"></a>
<div class="program_caption">
File 'content6.phtml':</div>
<pre class="program">&lt;?php foreach ($items as $item) { ?&gt;
  &lt;p&gt;{=$item=}&lt;/p&gt;
&lt;?php } ?&gt;
</pre>
<a name="example6_layout.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin -f contextdata.php <strong>--layout=layout6.phtml</strong> content6.phtml
&lt;html&gt;
  &lt;body&gt;

    &lt;div id="sidemenu"&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="/"&gt;Top&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/prod"&gt;Products&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/support"&gt;Support&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    &lt;/div&gt;

    &lt;div id="main-content"&gt;
<strong>  &lt;p&gt;&amp;lt;FOO&amp;gt;&lt;/p&gt;</strong>
<strong>  &lt;p&gt;&amp;amp;BAR&lt;/p&gt;</strong>
<strong>  &lt;p&gt;&amp;quot;BAZ&amp;quot;&lt;/p&gt;</strong>

    &lt;/div&gt;

    &lt;div id="footer"&gt;
&lt;hr /&gt;
&lt;address&gt;
  &lt;a href="mailto:webmaster@example.com"&gt;webmaster@example.com&lt;/a&gt;
&lt;/address&gt;
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/table&gt;
</pre>
<p>Target template and layout template don't share local variables.
It means that local variables set in a template are not available in layout template.
</p>
<p>If you want variables set in a temlate to be available in layout template,
you should use '$_context' array.
</p>
<a name="layout7.phtml"></a>
<div class="program_caption">
File 'layout7.phtml':</div>
<pre class="program">...
&lt;h1&gt;<strong>{=$title=}</strong>&lt;/h1&gt;

&lt;div id="main-content"&gt;
{==$_content=}
&lt;div&gt;

&lt;a href="<strong>{=$url=}</strong>"&gt;Next page&lt;/a&gt;
...
</pre>
<a name="content7.phtml"></a>
<div class="program_caption">
File 'content7.phtml':</div>
<pre class="program"><strong>&lt;?php $_context['title'] = 'Document Title'; ?&gt;</strong>
<strong>&lt;?php $_context['url']   = '/next/page'; ?&gt;</strong>
&lt;table&gt;
  ...content...
&lt;/table&gt;
</pre>
<a name="example7_layout2.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin --layout=layout7.phtml content7.phtml
...
&lt;h1&gt;<strong>Document Title</strong>&lt;/h1&gt;

&lt;div id="main-content"&gt;
&lt;table&gt;
  ...content...
&lt;/table&gt;

&lt;div&gt;

&lt;a href="<strong>/next/page</strong>"&gt;Next page&lt;/a&gt;
...
</pre>
<p>Using '$_context["_layout"]', it is able to specify layout template name in each template file.
If you assigned FALSE to '$_context["_layout"]', no layout template is used.
</p>
<a name="content8.phtml"></a>
<div class="program_caption">
File 'content8.phtml':</div>
<pre class="program"><strong>&lt;?php $_context['_layout'] = ':layout8_xhtml'; ?&gt;</strong>
&lt;h1&gt;Hello World!&lt;/h1&gt;
</pre>
<a name="layout8_html.phtml"></a>
<div class="program_caption">
File 'layout8_html.phtml':</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;
{==$_content=}
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="layout8_xhtml.phtml"></a>
<div class="program_caption">
File 'layout8_xhtml.phtml':</div>
<pre class="program">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;
  &lt;body&gt;
{==$_content=}
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="example8_layout3.result"></a>
<div class="terminal_caption">
Result: ':layout8_html' is specified in command-line option but ':layout8_xhtml' is used</div>
<pre class="terminal">$ phptenjin --postfix='.phtml' <strong>--layout=':layout8_html'</strong> content8.phtml
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;
  &lt;body&gt;
&lt;h1&gt;Hello World!&lt;/h1&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<a name="des-capturing"></a>
<h3 class="section2">Capturing</h3>
<p>It is able to capture any part of template.
</p>
<a name="example9.phtml"></a>
<div class="program_caption">
File 'example9.phtml':</div>
<pre class="program">&lt;?php $_context['title'] = 'Capture Test'; ?&gt;
&lt;html&gt;
  &lt;body&gt;

<strong>&lt;?php start_capture('content_part'); ?&gt;</strong>
    &lt;ul&gt;
&lt;?php for ($i = 0; $i &lt;= 2; $i++) { ?&gt;
      &lt;li&gt;i = {==$i=}&lt;/li&gt;
&lt;?php } ?&gt;
    &lt;/ul&gt;
<strong>&lt;?php stop_capture() ?&gt;</strong>

<strong>&lt;?php start_capture('footer_part'); ?&gt;</strong>
    &lt;div class="footer"&gt;copyright&amp;copy; 2007 kuwata-lab.com&lt;/div&gt;
<strong>&lt;?php stop_capture(); ?&gt;</strong>

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>Captured strings are accessable as local variables.
For example, you can get captured string as a variable '<code>content_part</code>' in the above example.
</p>
<p>A template can contain several capturing.
It is not able to nest capturing.
</p>
<p>In layout file, it is able to use strings captured in templates.
</p>
<a name="layout9.phtml"></a>
<div class="program_caption">
File 'layout9.phtml':</div>
<pre class="program">&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;{=$title=}&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;!-- HEADER --&gt;
<strong>&lt;?php start_placeholder('header_part'); ?&gt;</strong>
    &lt;h1&gt;{=$title=}&lt;/h1&gt;
<strong>&lt;?php stop_placeholder(); ?&gt;</strong>
    &lt;!-- /HEADER --&gt;

    &lt;!-- CONTENT --&gt;
<strong>{==$content_part=}</strong>
    &lt;!-- /CONTENT --&gt;

    &lt;!-- FOOTER --&gt;
<strong>&lt;?php start_placeholder('footer_part'); ?&gt;</strong>
    &lt;hr /&gt;
    &lt;address&gt;webmaster@localhost&lt;/address&gt;
<strong>&lt;?php stop_placeholder(); ?&gt;</strong>
    &lt;!-- /FOOTER --&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>'<code>start_placeholder("name") ... stop_placeholder()</code>' is quivarent to the following.
</p>
<pre class="program"><strong>&lt;?php if ($_context['name']) { ?&gt;</strong>
{==$_context['name']=}
<strong>&lt;?php } else { ?&gt;</strong>
    ...
<strong>&lt;?php } ?&gt;</strong>
</pre>
<p>The following result shows that content part and footer part are overrided by capturing in content template but header part is not.
</p>
<a name="example9_capture.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin --layout=layout9.phtml example9.phtml
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;Capture Test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;!-- HEADER --&gt;
    &lt;h1&gt;Capture Test&lt;/h1&gt;
    &lt;!-- /HEADER --&gt;

    &lt;!-- CONTENT --&gt;
    <strong>&lt;ul&gt;</strong>
      <strong>&lt;li&gt;i = 0&lt;/li&gt;</strong>
      <strong>&lt;li&gt;i = 1&lt;/li&gt;</strong>
      <strong>&lt;li&gt;i = 2&lt;/li&gt;</strong>
    <strong>&lt;/ul&gt;</strong>

    &lt;!-- /CONTENT --&gt;

    &lt;!-- FOOTER --&gt;
    <strong>&lt;div class="footer"&gt;copyright&amp;copy; 2007 kuwata-lab.com&lt;/div&gt;</strong>
    &lt;!-- /FOOTER --&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<a name="des-args"></a>
<h3 class="section2">Template Arguments</h3>
<p>It is able to specify template arguments in template files.
Template arguments are variables which are passed by main program via context object.
In the following example, '<code>title</code>' and '<code>name</code>' are template arguments.
</p>
<a name="example10.phtml"></a>
<div class="program_caption">
File 'example10.phtml':</div>
<pre class="program">&lt;?xml version="1.0"?&gt;
<strong>&lt;?php //@ARGS title, name ?&gt;</strong>
&lt;h1&gt;{=$title=}&lt;/h1&gt;
&lt;p&gt;Hello {=$name=}!&lt;/p&gt;
</pre>
<p>Template arguments line is converted into assignment statements of local variables.
</p>
<a name="example10_template_args.result"></a>
<pre class="terminal">$ phptenjin -s example10.phtml
&lt;?php echo '&lt;?xml version="1.0"?&gt;
'; <strong>$title = @$_context['title']; $name = @$_context['name'];</strong>
echo '&lt;h1&gt;', htmlspecialchars($title), '&lt;/h1&gt;
&lt;p&gt;Hello ', htmlspecialchars($name), '!&lt;/p&gt;
';
?&gt;
</pre>
<p>If template arguments are specified, other variables passed by context object are not set.
</p>
<a name="example11.phtml"></a>
<div class="program_caption">
File 'example11.phtml':</div>
<pre class="program">&lt;p&gt;
<strong>&lt;?php //@ARGS x ?&gt;</strong>
x = {=$x=}
y = {=$y=}   # error
&lt;/p&gt;
</pre>
<a name="example11_template_args_result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ phptenjin <strong>-c '$x=10; $y=20'</strong> example11.phtml
&lt;p&gt;
x = 10
y = 
Notice: Undefined variable: y in /usr/local/lib/php/Tenjin.php(488) : eval()'d code on line 4
   # error
&lt;/p&gt;
</pre>
<p>Special variable '<code>$_context</code>' which represents context object is always available whether template arguments are specified or not.
</p>
<br>


<a name="des-preprocess"></a>
<h3 class="section2">Preprocessing</h3>
<p>phpTenjin supports preprocessing of template.
Preprocessing executes some logics when templates are loaded and that logics are not executed when rendering.
Preprocessing makes your application much faster.
</p>
<p>Notation of preprocessing is the following.
</p>
<ul type="disc">
<li><code>&lt;?PHP ... ?&gt;</code> represents preprocessing statement.
</li>
<li><code>#{{...}}</code> represents preprocessing expression (without HTML escape).
</li>
<li><code>${{...}}</code> represents preprocessing expression (with HTML escape).
</li>
</ul>
<p>For example, assume the following template.
</p>
<a name="example12.phtml"></a>
<div class="program_caption">
File 'example12.phtml':</div>
<pre class="program"><strong>&lt;?PHP $states = array('CA'=&gt;"California", ?&gt;</strong>
<strong>&lt;?PHP                 'NY'=&gt;"New York", ?&gt;</strong>
<strong>&lt;?PHP                 'FL'=&gt;"Florida",  ?&gt;</strong>
<strong>&lt;?PHP                 'TX'=&gt;"Texas",  ?&gt;</strong>
<strong>&lt;?PHP                 'HI'=&gt;"Hawaii"); ?&gt;</strong>
&lt;?php $state = $params['state']; ?&gt;
&lt;?php $chk = array(true=&gt;' selected="selected"', false=&gt;''); ?&gt;
&lt;select name="state"&gt;
  &lt;option value=""&gt;-&lt;/option&gt;
<strong>&lt;?PHP $codes = array_keys($states); ?&gt;</strong>
<strong>&lt;?PHP sort($codes); ?&gt;</strong>
<strong>&lt;?PHP foreach ($codes as $code) { ?&gt;</strong>
  &lt;option value="<strong>{*==$code=*}</strong>"{==$chk[$state=='<strong>{*==$code=*}</strong>']=}&gt;<strong>{*=$states[$code]=*}</strong>&lt;/option&gt;
<strong>&lt;?PHP } ?&gt;</strong>
&lt;/select&gt;
</pre>
<p>If preprocessing is activated, the above will be converted into the following when template is loaded.
(Command-line option <code>-P</code> shows the result of preprocessing.)
</p>
<a name="example12_preprocessed.result"></a>
<div class="terminal_caption">
Result of preprocessing:</div>
<pre class="terminal">$ phptenjin <strong>-P</strong> example12.phtml
&lt;?php $state = $params['state']; ?&gt;
&lt;?php $chk = array(true=&gt;' selected="selected"', false=&gt;''); ?&gt;
&lt;select name="state"&gt;
  &lt;option value=""&gt;-&lt;/option&gt;
  &lt;option value="CA"{==$chk[$state=='CA']=}&gt;California&lt;/option&gt;
  &lt;option value="FL"{==$chk[$state=='FL']=}&gt;Florida&lt;/option&gt;
  &lt;option value="HI"{==$chk[$state=='HI']=}&gt;Hawaii&lt;/option&gt;
  &lt;option value="NY"{==$chk[$state=='NY']=}&gt;New York&lt;/option&gt;
  &lt;option value="TX"{==$chk[$state=='TX']=}&gt;Texas&lt;/option&gt;
&lt;/select&gt;
</pre>
<p>This means that for-loop is executed only once when template is loaded and is not executed when rendering.
In the result, rendering speed becomes to be much faster.
</p>
<p>And the PHP code is here. This shows that there is no for-loop.
</p>
<a name="example12_preprocessed_source.result"></a>
<div class="terminal_caption">
Translated script code:</div>
<pre class="terminal">$ phptenjin <strong>--preprocess</strong> -sb example12.phtml
 $state = $params['state']; 
 $chk = array(true=&gt;' selected="selected"', false=&gt;''); 
echo '&lt;select name="state"&gt;
  &lt;option value=""&gt;-&lt;/option&gt;
  &lt;option value="CA"', $chk[$state=='CA'], '&gt;California&lt;/option&gt;
  &lt;option value="FL"', $chk[$state=='FL'], '&gt;Florida&lt;/option&gt;
  &lt;option value="HI"', $chk[$state=='HI'], '&gt;Hawaii&lt;/option&gt;
  &lt;option value="NY"', $chk[$state=='NY'], '&gt;New York&lt;/option&gt;
  &lt;option value="TX"', $chk[$state=='TX'], '&gt;Texas&lt;/option&gt;
&lt;/select&gt;
';
</pre>
<p>If you have errors on preprocessing, you should check source script by <code>-Ps</code> option<sup>(<a href="#fnref:3" name="fnlink:3">*3</a>)</sup>.
</p>
<p>The following is an another example.
Assume that <code>link_to()</code> is a helper method which takes label and url and generate
<code>&lt;a&gt;&lt;/a&gt;</code> tag.
In this case, label and url can be parameterized by <code>_p("...")</code> and <code>_ep("...")</code>.
The former is converted into <code>{== ... =}</code> and the latter converted into <code>{= ... =}</code>
by preprocessor.
</p>
<a name="example13.phtml"></a>
<div class="program_caption">
File 'example13.phtml':</div>
<pre class="program">&lt;?PHP // ex. link_to('Show', '/show/1')  =&gt; &lt;a href="/show/1"&gt;Show&lt;/a&gt; ?&gt;
&lt;?PHP function link_to($label, $url) { ?&gt;
&lt;?PHP     $url = preg_replace('/%2F/', '/', urlencode($url)); ?&gt;
&lt;?PHP     return "&lt;a href=\"$url\"&gt;$label&lt;/a&gt;"; ?&gt;
&lt;?PHP } ?&gt;
{*==link_to('Show '.<strong>_ep('$params["name"]')</strong>, '/items/show/'.<strong>_p('$params["id"]')</strong>)=*}
</pre>
<a name="example13_preprocessed.result"></a>
<div class="terminal_caption">
Preprocessed template:</div>
<pre class="terminal">$ phptenjin <strong>-P</strong> example13.phtml
&lt;a href="/items/show/<strong>{==$params["id"]=}"</strong>&gt;Show <strong>{=$params["name"]=}</strong>&lt;/a&gt;
</pre>
<a name="example13_preprocessed_source.result"></a>
<div class="terminal_caption">
Translated script code:</div>
<pre class="terminal">$ phptenjin <strong>--preprocess</strong> -sb example13.phtml
echo '&lt;a href="/items/show/', $params["id"], '"&gt;Show ', htmlspecialchars($params["name"]), '&lt;/a&gt;
';
</pre>
<p>There are many web-application framework and they provides helper functions.
These helper functions are divided into two groups.
</p>
<ul type="disc">
<li><code>link_to()</code> or <code>_()</code> (function for M17N) return the same result
   when the same arguments are passed.
   These functions can be expanded by preprocessor.
</li>
<li>Some functions return the different result even if the same arguments are passed.
   These functions can't be expaned by preprocessor.
</li>
</ul>
<p>Preprocessor has the power to make your application much faster,
but it may make the debugging difficult.
You should use it carefully.
</p>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:3" href="#fnlink:3">*3</a>)</dt>
  <dd>Command-line option '-Ps' is available but '-PS' is not availabe. This is a current restriction of phptenjin. </dd>
 </dl>
</div>
<br>


<a name="des-otheropts"></a>
<h3 class="section2">Other Options</h3>
<ul type="disc">
<li>Command-line option '<code>--path=dir1,dir2,...</code>' sepcifies template directory path.
</li>
</ul>
<br>


<br>


<a name="devguide"></a>
<h2 class="section1">Developer's Guide</h2>
<p>This section shows how to use phpTenjin in your PHP script.
</p>
<p>If you want to know the notation or features of phpTenjin, see <a href="#desguide">Designer's Guide</a> section.
</p>
<a name="dev-example"></a>
<h3 class="section2">An Example</h3>
<p>The following is an example to use phpTenjin in PHP.
</p>
<div class="program_caption">
Example:</div>
<pre class="program">require_once 'Tenjin.php';
$engine = new Tenjin_Engine();
$context = array('title'=&gt;'phpTenjin Example', 'items'=&gt;array('AAA','BBB','CCC'));
$filename = 'file.phtml';
$output = $engine-&gt;render($filename, $context);
echo $output;
</pre>
<br>


<a name="dev-classes"></a>
<h3 class="section2">Classes and Functions in phpTenjin</h3>
<p>phpTenjin has the follwoing classes.
</p>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin_Template </b></dt>
<dd class="dd3">
    This class represents a template file.
    An object of Tenjin_Template correspond to a template file.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin_Engine </b></dt>
<dd class="dd3">
    This class represents some template objects.
    It can handle nested template and layout template.
    Using Tenjin_Engine class, you can use phpTenjin as a template engine for web application.
</dd>
</dl>
<br>


<a name="dev-templateclass"></a>
<h3 class="section2">Class Tenjin_Template</h3>
<p>Tenjin_Template class represents a template file.
An object of Tenjin_Template corresponds to a template file.
It doesn't support nested template nor layout template (use Tenjin_Engine class instead).
</p>
<p>This class has the following methods and attributes.
</p>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin_Template($filename=null, properties=array()) </b></dt>
<dd class="dd3">
    Create template object. If filename is given, read and convert it to PHP code.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin_Template-&gt;convert($input, $filename=null) </b></dt>
<dd class="dd3">
    Convert input text into PHP code and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin_Template-&gt;convert_file($filename) </b></dt>
<dd class="dd3">
    Convert file into PHP code and return it.
    This is equivarent to <code>Tenjin_Template-&gt;convert(file_get_contents($filename), $filename)</code>
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin_Template-&gt;render($context=array()) </b></dt>
<dd class="dd3">
    Convert PHP code, evaluate it with context data, and return the result of evaluation.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin_Template-&gt;script </b></dt>
<dd class="dd3">
    Converted PHP code
</dd>
</dl>
<p>The followings are examples to use Tenjin_Template in PHP script.
</p>
<a name="example14.phtml"></a>
<div class="program_caption">
File 'example14.phtml':</div>
<pre class="program">&lt;h1&gt;{=$title=}&lt;/h1&gt;
&lt;ul&gt;
&lt;?php foreach ($items as $item) { ?&gt;
 &lt;li&gt;{=$item=}&lt;/li&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;
</pre>
<a name="example14.php"></a>
<div class="program_caption">
File 'example14.php':</div>
<pre class="program">&lt;?php
/// template file
$filename = 'example14.phtml';

/// convert into php code
require_once 'Tenjin.php';
$template = <strong>new Tenjin_Template($filename);</strong>
/// or
//$template = new Tenjin_Template();
//$script = <strong>$template-&gt;convert_file($filename);</strong>
/// or
//$template = new Tenjin_Template();
//$input = file_get_contents($filename);
//$script = <strong>$template-&gt;convert($input, $filename);</strong>  # filename is optional

/// show converted php code
echo "---- php code ----\n";
echo <strong>$template-&gt;script</strong>;

/// evaluate php code
$context = array('title'=&gt;'phpTenjin Example', 'items'=&gt;array('&lt;AAA&gt;','B&amp;B','"CCC"'));
$output = <strong>$template-&gt;render($context)</strong>;
echo "---- output ----\n";
echo $output;
</pre>
<a name="example14_tmplclass.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ php example14.php
---- php code ----
echo '&lt;h1&gt;', htmlspecialchars($title), '&lt;/h1&gt;
&lt;ul&gt;
'; foreach ($items as $item) { 
echo ' &lt;li&gt;', htmlspecialchars($item), '&lt;/li&gt;
'; } 
echo '&lt;/ul&gt;
';
---- output ----
&lt;h1&gt;phpTenjin Example&lt;/h1&gt;
&lt;ul&gt;
 &lt;li&gt;&amp;lt;AAA&amp;gt;&lt;/li&gt;
 &lt;li&gt;B&amp;amp;B&lt;/li&gt;
 &lt;li&gt;&amp;quot;CCC&amp;quot;&lt;/li&gt;
&lt;/ul&gt;
</pre>
<br>


<a name="dev-engineclass"></a>
<h3 class="section2">Class Tenjin_Engine</h3>
<p>Tenjin_Engine class contains some template objects.
It can handle nested template and layout template.
Using Tenjin_Engine class, you can use phpTenjin as a template engine for web application.
</p>
<p>This class has the following methods.
</p>
<dl class="dl3">
<dt class="dt3"><b>
new Tenjin_Engine($properties=array('prefix'=&gt;null, 'postfix'=&gt;null, 'layout'=&gt;null, 'path'=&gt;null, 'cache'=&gt;true, 'preprocess'=&gt;false, 'templateclass'=&gt;'Tenjin_Template')) </b></dt>
<dd class="dd3">
    Create Engine object.
    '<code>path</code>' represents template search path and it should be an array of directory name.
    If other properties are passed then they are passed to Tenjin_Template() internally.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
Tenjin_Engine-&gt;render($template_name, $context=array(), $layout=null) </b></dt>
<dd class="dd3">
    Convert template into PHP code, evaluate it with context data, and return the result of it.
    If <code>layout</code> is TRUE or NULL then layout template name specified by constructor option is
    used as layout template, else if FALSE then layout template is not used,
    else if string then it is regarded as layout template name.
</dd>
</dl>
<p>Argument <code>$template_name</code> in render() methods is filename or short name of template.
Template short name is a string starting with colon (':').
For example, '<code>render(":list", context)</code>' is equivarent to '<code>render("user_list.phtml", context)</code>' if prefix option is '<code>user_</code>' and postfix option is '<code>.phtml</code>'.
</p>
<p>In template file, the followings are available.
</p>
<dl class="dl3">
<dt class="dt3"><b>
$_content </b></dt>
<dd class="dd3">
    This variable represents the result of evaluation of other template.
    This is available only in layout template file.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
import($template_name) </b></dt>
<dd class="dd3">
    Include other template file.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
start_capture(name) </b></dt>
<dd class="dd3">
    Start capturing. Result will be stored into <code>$_context['<em>name</em>']</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
stop_capture() </b></dt>
<dd class="dd3">
    Stop capturing.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
start_placeholder(varname), stop_placeholder() </b></dt>
<dd class="dd3">
    Placeholder is a region from start_placeholder() to stop_placeholder().
    If captured string as <em>varname</em> exists then use it as content,
    else use content in placeholder as is.
    For example,
<pre class="terminal">&lt;?php start_placeholder('foo'); ?&gt;
  ...
&lt;?php stop_placeholder(); ?&gt;
</pre>
    is equivarent to:
<pre class="terminal">&lt;?php if (array_key_exists('foo', $_context['foo'])) { ?&gt;
&lt;?php     echo $_context['foo']; ?&gt;
&lt;?php } else { ?&gt;
  ...
&lt;?php } ?&gt;
</pre>
</dd>
</dl>
<p>(Notice that include(), start_capture(), stop_capture(), start_placeholder(), and stop_placeholder() are built-in macros of phpTenjin and they are not subroutine of PHP.)
</p>
<p>The followings are example of Tenjin_Engine class.
</p>
<a name="user_form.phtml"></a>
<div class="program_caption">
File 'user_form.phtml':</div>
<pre class="program">&lt;?php //@ARGS params ?&gt;
&lt;p&gt;
  Name:  &lt;input type="text" name="name"  value="{=$params['name']=}" /&gt;&lt;br /&gt;
  Email: &lt;input type="text" name="email" value="{=$params['email']=}" /&gt;&lt;br /&gt;
  Gender:
&lt;?php $gender = $params['gender']; ?&gt;
&lt;?php $chk = array(true=&gt;' checked="checked"', false=&gt;''); ?&gt;
  &lt;input type="radio" name="gender" value="m" {=$chk[$gender=='m']=} /&gt;Male
  &lt;input type="radio" name="gender" value="f" {=$chk[$gender=='f']=} /&gt;Female
&lt;/p&gt;
</pre>
<a name="user_create.phtml"></a>
<div class="program_caption">
File 'user_create.phtml':</div>
<pre class="program">&lt;?php //@ARGS ?&gt;
&lt;form action="user_app.cgi" method="post"&gt;
  &lt;input type="hidden" name="action" value="create" /&gt;
<strong>&lt;?php import(':form'); ?&gt;</strong>
  &lt;input type="submit" value="Create" /&gt;
&lt;/form&gt;
</pre>
<a name="user_edit.phtml"></a>
<div class="program_caption">
File 'user_edit.phtml':</div>
<pre class="program">&lt;?php //@ARGS params ?&gt;
&lt;form action="user_app.cgi" method="post"&gt;
  &lt;input type="hidden" name="action" value="edit" /&gt;
  &lt;input type="hidden" name="id" value="{=$params['id']=}" /&gt;
<strong>&lt;?php import(':form'); ?&gt;</strong>
  &lt;input type="submit" value="Edit" /&gt;
&lt;/form&gt;
</pre>
<a name="user_layout.phtml"></a>
<div class="program_caption">
File 'user_layout.phtml':</div>
<pre class="program">&lt;?php //@ARGS _content, title ?&gt;
&lt;html&gt;
  &lt;body&gt;

    &lt;h1&gt;{=$title=}&lt;/h1&gt;

    &lt;div id="main-content"&gt;
<strong>{==$_content=}</strong>
    &lt;/div&gt;

    &lt;div id="footer"&gt;
<strong>&lt;?php import('footer.html'); ?&gt;</strong>
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="footer.html"></a>
<div class="program_caption">
File 'footer.html':</div>
<pre class="program">&lt;?php //@ARGS ?&gt;
&lt;hr /&gt;
&lt;address&gt;
  &lt;a href="mailto:webmaster@example.com"&gt;webmaster@example.com&lt;/a&gt;
&lt;/address&gt;
</pre>
<a name="user_app.cgi"></a>
<div class="program_caption">
File 'user_app.cgi':</div>
<pre class="program">#!/usr/bin/env php
&lt;?php

<strong>require_once 'Tenjin.php';</strong>

/// set action ('create' or 'edit')
$action = 'create';

/// set context data
if ($action == 'create') {
    $title = 'Create User';
    $params = array(
        'name'=&gt;null, 'email'=&gt;null, 'gender'=&gt;null, 'id'=&gt;null,
    );
}
else {
    $title = 'Edit User';
    $params = array(
        'name'   =&gt; 'Margalette',
        'email'  =&gt; 'meg@example.com',
        'gender' =&gt; 'f',
        'id'     =&gt; 123,
    );
}
<strong>$context = array('title'=&gt;$title, 'params'=&gt;$params)</strong>;

/// create engine object
$layout = ':layout';   // or 'user_layout.phtml'
<strong>$properties = array('prefix'=&gt;'user_', 'postfix'=&gt;'.phtml', 'layout'=&gt;$layout)</strong>;
<strong>$engine = new Tenjin_Engine($properties)</strong>;

/// evaluate template
$template_name = ':'.$action;   // ':create' or ':edit'
<strong>$output = $engine-&gt;render($template_name, $context)</strong>;
echo $output;
</pre>
<a name="user_app.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ php user_app.cgi create
&lt;html&gt;
  &lt;body&gt;

    &lt;h1&gt;Create User&lt;/h1&gt;

    &lt;div id="main-content"&gt;
<strong>&lt;form action="user_app.cgi" method="post"&gt;</strong>
<strong>  &lt;input type="hidden" name="action" value="create" /&gt;</strong>
<strong>&lt;p&gt;</strong>
<strong>  Name:  &lt;input type="text" name="name"  value="" /&gt;&lt;br /&gt;</strong>
<strong>  Email: &lt;input type="text" name="email" value="" /&gt;&lt;br /&gt;</strong>
<strong>  Gender:</strong>
<strong>  &lt;input type="radio" name="gender" value="m"  /&gt;Male</strong>
<strong>  &lt;input type="radio" name="gender" value="f"  /&gt;Female</strong>
<strong>&lt;/p&gt;</strong>
<strong>  &lt;input type="submit" value="Create" /&gt;</strong>
<strong>&lt;/form&gt;</strong>

    &lt;/div&gt;

    &lt;div id="footer"&gt;
<strong>&lt;hr /&gt;</strong>
<strong>&lt;address&gt;</strong>
<strong>  &lt;a href="mailto:webmaster@example.com"&gt;webmaster@example.com&lt;/a&gt;</strong>
<strong>&lt;/address&gt;</strong>
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<a name="dev-initopts"></a>
<h3 class="section2">Template Initialize Options</h3>
<p>Tenjin_Template() can take the follwoing options.
</p>
<ul type="disc">
<li>'<code>escapefunc</code>' (string) specifies function name to escape string.
  Default is '<code>htmlspecialchars</code>'.
</li>
</ul>
<p>Constructor of Tenjin_Engine can also take the same options as above.
These options given to constructor of Tenjin_Engine are passed to constructor of Tenjin_Template internally.
</p>
<a name="example15.php"></a>
<div class="program_caption">
File 'example15.php':</div>
<pre class="program">&lt;?php
require_once 'tenjin.php';
$filename = 'example14.phtml';
$template = new Tenjin_Template($filename, <strong>array('escapefunc'=&gt;'escapeHTML')</strong>);
echo $template-&gt;script;

function escapeHTML($s) {
    $s = preg_replace('/\&amp;/', '&amp;amp;', $s);
    $s = preg_replace('/&lt;/',  '&amp;lt;',  $s);
    $s = preg_replace('/&gt;/',  '&amp;gt;',  $s);
    $s = preg_replace('/"/',  '&amp;quot;', $s);
    $s = preg_replace('/\'/', '&amp;#039;', $s);
    return $s;
}
$context = array(
    'title' =&gt; 'phpTenjin Example',
    'items' =&gt; array('&lt;foo&gt;', '&amp;bar', '"baz"'),
);
$output = $template-&gt;render($context);
echo $output;
?&gt;
</pre>
<a name="example15_escapefunc.result"></a>
<div class="terminal_caption">
Result:</div>
<pre class="terminal">$ php example15.php
echo '&lt;h1&gt;', escapeHTML($title), '&lt;/h1&gt;
&lt;ul&gt;
'; foreach ($items as $item) { 
echo ' &lt;li&gt;', escapeHTML($item), '&lt;/li&gt;
'; } 
echo '&lt;/ul&gt;
';
&lt;h1&gt;phpTenjin Example&lt;/h1&gt;
&lt;ul&gt;
 &lt;li&gt;&amp;lt;foo&amp;gt;&lt;/li&gt;
 &lt;li&gt;&amp;amp;bar&lt;/li&gt;
 &lt;li&gt;&amp;quot;baz&amp;quot;&lt;/li&gt;
&lt;/ul&gt;
</pre>
<br>


<a name="dev-othertopics"></a>
<h3 class="section2">Other Topics</h3>
<ul type="disc">
<li>Tenjin_Template detects newline character ("\n" or "\r\n") automatically.
   If input file contains "\r\n", phpTenjin generates output which contains "\r\n".
</li>
</ul>
<ul type="disc">
<li>Tenjin_Template-&gt;render() can be called many times.
   If you create a Tenjin_Template object, you can call render() method many times.
</li>
</ul>
<ul type="disc">
<li>Tenjin_Template-&gt;convert() also can be called many times.
  If you create a Tenjin_Template object, you can call convert() (and also render()) method many times.
</li>
</ul>
<br>


<br>



   </div>
  </blockquote>

 </body>
</html>
